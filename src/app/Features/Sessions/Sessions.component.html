<app-main-layout 
  [pageTitle]="'إدارة الجلسات'" 
  [buttonText]="'إضافة جلسة'"
  (buttonClick)="openModal()"
  (pageSizeChange)="onPageSizeChanged($event)"
  (search)="onSearch($event)">
</app-main-layout>

<app-sahred-table 
  [tableData]="displayedSessions" 
  [columns]="columns"
  (edit)="onEdit($event)"
  (delete)="onDelete($event)">
</app-sahred-table>

<app-afterTable
  [totalItems]="sessionsData().totalItems"
  [currentPage]="sessionsData().currentPage"
  [pageSize]="sessionsData().pageSize"
  [hasPrevious]="sessionsData().hasPrevious"
  [hasNext]="sessionsData().hasNext"
  (nextPageCounter)="onNextPage($event)"
  (previousPageCounter)="onPreviousPage($event)"/>

<!-- MODAL إضافة/تعديل -->
<div
  class="modal fade"
  [class.show]="showModal"
  [style.display]="showModal ? 'block' : 'none'"
  tabindex="-1"
  role="dialog">

  <div class="modal-dialog" role="document">
    <div class="modal-content">

      <!-- HEADER -->
      <div class="modal-header d-flex justify-content-between">
        <h5 class="modal-title">{{ isEditMode ? 'تعديل الجلسة' : 'إضافة جلسة جديدة' }}</h5>
        <button type="button" class="close" (click)="closeModal()">
          <span>&times;</span>
        </button>
      </div>

      <!-- BODY -->
      <form #sessionForm="ngForm">
        <div class="modal-body">
          <div class="form-group mb-2">
            <label>التاريخ <span class="text-danger">*</span></label>
            <input 
              type="date" 
              class="form-control" 
              [(ngModel)]="sessionDate" 
              name="sessionDate" 
              required />
          </div>

          <div class="form-group mb-2">
            <label>بداية <span class="text-danger">*</span></label>
            <input 
              type="time" 
              class="form-control" 
              [(ngModel)]="startTime" 
              name="startTime" 
              step="1"
              required />
          </div>

          <div class="form-group mb-2">
            <label>نهاية <span class="text-danger">*</span></label>
            <input 
              type="time" 
              class="form-control" 
              [(ngModel)]="endTime" 
              name="endTime" 
              step="1"
              required />
          </div>

          <div class="form-group mb-2">
            <label>الموضوع <span class="text-danger">*</span></label>
            <input 
              type="text" 
              class="form-control" 
              [(ngModel)]="topic" 
              name="topic" 
              required />
          </div>

          <div class="form-group mb-2">
            <label>القاعة <span class="text-danger">*</span></label>
            <select 
              class="form-control" 
              [(ngModel)]="selectedRoomId" 
              name="selectedRoomId"
              required>
              <option value="">--- اختر قاعة ---</option>
              <option *ngFor="let r of rooms()" [value]="r.id">
                {{ r.name }} - {{ r.location }}
              </option>
            </select>
          </div>

          <div class="form-group mb-2">
            <label>الدورة <span class="text-danger">*</span></label>
            <select 
              class="form-control" 
              [(ngModel)]="selectedCourseId" 
              name="selectedCourseId"
              required>
              <option value="">--- اختر دورة ---</option>
              <option *ngFor="let c of courses()" [value]="c.id">
                {{ c.name }}
              </option>
            </select>
          </div>
        </div>

        <!-- FOOTER -->
        <div class="modal-footer text-center">
          <button 
            class="btn btn-primary me-2" 
            type="button"
            (click)="saveSession()"
            [disabled]="sessionForm.invalid">
            حفظ
          </button>
          <button class="btn btn-danger" type="button" (click)="closeModal()">إلغاء</button>
        </div>
      </form>

    </div>
  </div>
</div>

<!-- MODAL تأكيد الحذف -->
<div
  class="modal fade"
  [class.show]="showDeleteModal"
  [style.display]="showDeleteModal ? 'block' : 'none'"
  tabindex="-1"
  role="dialog">

  <div class="modal-dialog" role="document">
    <div class="modal-content">

      <!-- HEADER -->
      <div class="modal-header d-flex justify-content-between">
        <h5 class="modal-title">تأكيد الحذف</h5>
        <button type="button" class="close" (click)="closeDeleteModal()">
          <span>&times;</span>
        </button>
      </div>

      <!-- BODY -->
      <div class="modal-body">
        <p>هل أنت متأكد من حذف هذه الجلسة؟</p>
        <p *ngIf="sessionToDelete" class="text-muted">
          الموضوع: {{ sessionToDelete.topic }}
        </p>
      </div>

      <!-- FOOTER -->
      <div class="modal-footer text-center">
        <button class="btn btn-danger me-2" (click)="confirmDelete()">حذف</button>
        <button class="btn btn-secondary" (click)="closeDeleteModal()">إلغاء</button>
      </div>

    </div>
  </div>
</div>